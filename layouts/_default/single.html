{{ define "main" }}
{{- if eq .Params.type "page" -}}
    {{- partial "header.html" . -}}
{{- else -}}
    {{- partial "post-header.html" . -}}
{{- end -}}
<!-- Post Content -->
<article>
    <div class="container">
        {{- if ne .Params.type "page" -}}
            <div class = "row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <!-- Show Top Adsense -->
                    {{- if $.Param "adsense.showTop" -}}
                        {{- partial "widget/adsense-responsive.html" . -}}
                    {{- end -}}
                </div>
            </div>
        {{- end -}}
        <div class="row main-content">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Article Content -->
                <div class="post-body entry-content">
                    {{ .Scratch.Set "finalContent" "" }}
                    {{ if $.Site.Params.autoFigure }}
                        {{ $reAltTitleIn := "<p><img src=\"([^\"]+)\" alt=\"([^\"]+)\" title=\"([^\"]+)\" /></p>" }}
                        {{ $reAltTitleOut := "<figure><img src=\"$1\" alt=\"$2\" title=\"$3\"><figcaption class='text-muted'>$2</figcaption></figure>" }}
                        {{ $contentAltTitle := .Content | replaceRE $reAltTitleIn $reAltTitleOut | safeHTML }}
                        {{ $reAltIn := "<p><img src=\"([^\"]+)\" alt=\"([^\"]+)\" /></p>" }}
                        {{ $reAltOut := "<figure><img src=\"$1\" alt=\"$2\" title=\"$2\"><figcaption class='text-muted'>$2</figcaption></figure>" }}
                        {{ $contentAlt := $contentAltTitle | replaceRE $reAltIn $reAltOut | safeHTML }}
                        {{ .Scratch.Set "finalContent" $contentAlt }}
                    {{ else }}
                        {{ .Scratch.Set "finalContent" .Content }}
                    {{ end }}
                    {{ $codeblockIn := "(?s:<div class=\"highlight\">(.*?)</div>)" }}
                    {{ $codeblockOut := "<figure class=\"highlight\">$1</figure>" }}
                    {{ $codeblockContent := (.Scratch.Get "finalContent") | replaceRE $codeblockIn $codeblockOut | safeHTML }}
                    {{ .Scratch.Set "finalContent" $codeblockContent }}
                    {{ if (and ($.Param "adsense.showMiddle") (ne .Params.type "page")) }}
                        {{ replace (.Scratch.Get "finalContent") "<!--adsense-->" (partial "widget/adsense-inarticle.html" .) | safeHTML }}
                    {{ else }}
                        {{ .Scratch.Get "finalContent" }}
                    {{ end }}
                </div>
            </div>
        </div>
        <hr class='section-divider' />
        {{- if ne .Params.type "page" -}}
            {{- partial "post-footer.html" . -}}
        {{- end -}}
    </div>
</article>
{{ end }}