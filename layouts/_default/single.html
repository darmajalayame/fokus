{{ define "main" }}

{{ if eq .Params.type "staticpage" }}
    {{ partial "header.html" . }}
{{ else }}
    {{ partial "postheader.html" . }}
{{ end }}

<!-- Post Content -->
<article>
    <div class="container">

        {{ if ne .Params.type "staticpage" }}

            <div class = "row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
                    <!-- Show Top Adsense -->
                    {{ if $.Param "adsense.showTop" }}
                        {{ partial "widget/adsense-responsive.html" . }}
                    {{ end }}
                    
                </div>
            </div>
        
        {{ end }}

        <div class="row main-content">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <!-- Article Content -->
                <div class="post-body entry-content">
                    {{ .Scratch.Set "finalContent" "" }}
                    
                    {{ if $.Site.Params.autoFigure }}
                        {{ $reAltTitleIn := "<p><img src=\"([^\"]+)\" alt=\"([^\"]+)\" title=\"([^\"]+)\" /></p>" }}
                        {{ $reAltTitleOut := "<figure><img src=\"$1\" alt=\"$2\" title=\"$3\"><figcaption class='text-muted'>$2</figcaption></figure>" }}
                        {{ $contentAltTitle := .Content | replaceRE $reAltTitleIn $reAltTitleOut | safeHTML }}

                        {{ $reAltIn := "<p><img src=\"([^\"]+)\" alt=\"([^\"]+)\" /></p>" }}
                        {{ $reAltOut := "<figure><img src=\"$1\" alt=\"$2\" title=\"$2\"><figcaption class='text-muted'>$2</figcaption></figure>" }}
                        {{ $contentAlt := $contentAltTitle | replaceRE $reAltIn $reAltOut | safeHTML }}
                        
                        {{ .Scratch.Set "finalContent" $contentAlt }}
                    {{ else }}
                        {{ .Scratch.Set "finalContent" .Content }}
                    {{ end }}

                    {{ if (and ($.Param "adsense.showMiddle") (ne .Params.type "staticpage")) }}
                        {{ replace (.Scratch.Get "finalContent") "<!--adsense-->" (partial "widget/adsense-inarticle.html" .) | safeHTML }}
                    {{ else }}
                        {{ .Scratch.Get "finalContent" }}
                    {{ end }}

                </div>

            </div>
        </div>

        <hr class='section-divider'/>

        {{ if ne .Params.type "staticpage" }}

            <div class = "row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
                    <!-- Show Bottom Adsense -->
                    {{ if $.Param "adsense.showBottom" }}
                        {{ partial "widget/adsense-responsive.html" . }}
                    {{ end }}
                    
                    <!-- Content and Code License -->
                    {{ if $.Param "license.visible" }}
                        {{ partial "license.html" . }}
                    {{ end }}

                    <!-- Native social share -->
                    {{ partial "widget/social-share.html" . }}

                    <!-- Blockadblock message -->
                    {{ if .Site.Params.Widget.blockAdBlock }}
                        {{ partial "widget/blockadblock.html" . }}
                    {{ end }}

                    <!-- Buy me a coffee -->
                    {{ partial "widget/buymeacoffee.html" . }}

                    <!-- Show AddThis if enabled -->
                    {{ if .Site.Params.Widget.addThis }}
                        {{ partial "widget/addthis.html" . }}
                    {{ end }}

                    <!-- Show related articles -->
                    {{ if $.Param "relatedVisible" }}
                    <div class="post-body entry-similar">
                        {{ partial "related.html" . }}
                    </div>
                    {{ end }}

                    <!-- Author profile -->
                    <!--                            
                    {{ partial "widget/author-profile.html" . }}
                    -->

                    <!-- Email Subscribe -->
                    <div class="post-body entry-subscribe">
                        {{ partial "widget/email-subscribe.html" . }}
                    </div>

                    <!-- Disqus comments -->
                    {{ partial "widget/disqus.html" . }}
                    
                </div>
            </div>

            {{ partial "nextprev.html" . }}

        {{ end }}

    </div>
</article>

{{ end }}
