<!-- AdBlock detection -->
{{ $blockadblock := slice (resources.Get "js/abcheck.js") | resources.Concat "js/abcheck.js" | resources.Minify | resources.Fingerprint }}
{{ $abdetectjs := slice $blockadblock | resources.Concat "abdetect.js" }}
{{ $string := (printf "var fabjs = '%s'; var fabintegrity = '%s';" ($abdetectjs.Permalink) ($blockadblock.Data.Integrity)) }}
{{ $targetPath := "js/vars.js" }}
{{ $vars := $string | resources.FromString $targetPath }}
<!-- Fokus js -->
{{ $fokusjs := resources.Get "js/fokus_template.js" | resources.ExecuteAsTemplate "js/fokus.js" . }}
{{ $indexScratch := .Scratch }}
{{ $indexScratch.Add "jsassets" (slice $fokusjs) }}
{{ range .Site.Params.customJSAssets }} 
    {{ $indexScratch.Add "jsassets" (slice (resources.Get .)) }}
{{ end }}
{{ $appjs := $indexScratch.Get "jsassets" | resources.Concat "js/fokus-bundle.js" | resources.Minify | resources.Fingerprint }}
{{ .Scratch.Set "appjs" $appjs.RelPermalink }}
{{ .Scratch.Set "appjsintegrity" $appjs.Data.Integrity }}
{{ $assetid := delimit (slice (.Scratch.Get "appcssintegrity") (.Scratch.Get "appjsintegrity")) "" }}
{{ .Scratch.Set "swversion" (sha256 $assetid) }}
{{ $swjs := resources.Get "js/sw_template.js" | resources.ExecuteAsTemplate "sw.js" . | resources.Minify }}
<script src="{{ $appjs.RelPermalink }}" integrity="{{ $appjs.Data.Integrity }}"></script>
{{- template "_internal/google_analytics_async.html" . -}}
{{- partialCached "widget-scripts.html" . -}}
<script type="text/javascript">
    if ('serviceWorker' in navigator) {
        {{ printf "navigator.serviceWorker.register('%s', {scope: '/'});" $swjs.RelPermalink | safeJS }}
        window.addEventListener('load', function() {
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({'command': 'trimCaches'});
            }
        });
    }
</script>